"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,o=1,r=arguments.length;o<r;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(t,d,u,a){return new(u=u||Promise)(function(o,e){function r(t){try{i(a.next(t))}catch(t){e(t)}}function n(t){try{i(a.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?o(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,n)}i((a=a.apply(t,d||[])).next())})},__generator=this&&this.__generator||function(o,r){var n,i,d,u={label:0,sent:function(){if(1&d[0])throw d[1];return d[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,i&&(d=2&e[0]?i.return:e[0]?i.throw||((d=i.return)&&d.call(i),0):i.next)&&!(d=d.call(i,e[1])).done)return d;switch(i=0,d&&(e=[2&e[0],d.value]),e[0]){case 0:case 1:d=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,i=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(d=0<(d=u.trys).length&&d[d.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!d||e[1]>d[0]&&e[1]<d[3])){u.label=e[1];break}if(6===e[0]&&u.label<d[1]){u.label=d[1],d=e;break}if(d&&u.label<d[2]){u.label=d[2],u.ops.push(e);break}d[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(o,u)}catch(t){e=[6,t],i=0}finally{n=d=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},page_load="page_load",product_searched="product_searched",product_list_viewed="product_list_viewed",product_list_filtered="product_list_filtered",promotion_viewed="promotion_viewed",promotion_clicked="promotion_clicked",product_clicked="product_clicked",product_viewed="product_viewed",product_added="product_added",product_removed="product_removed",cart_viewed="cart_viewed",checkout_started="checkout_started",checkout_step_viewed="checkout_step_viewed",checkout_step_completed="checkout_step_completed",payment_info_entered="payment_info_entered",order_completed="order_completed",order_updated="order_updated",order_refunded="order_refunded",order_cancelled="order_cancelled",coupon_entered="coupon_entered",coupon_applied="coupon_applied",coupon_denied="coupon_denied",coupon_removed="coupon_removed",product_added_to_wish_list="product_added_to_wish_list",product_removed_from_wish_list="product_removed_from_wish_list",wish_list_product_added_to_cart="wish_list_product_added_to_cart",product_shared="product_shared",cart_shared="cart_shared",product_reviewed="product_reviewed",logged_in="logged_in",signed_up="signed_up",logged_out="logged_out",error="error",Meta=function(){this.session="",this.is_anon=!0,this.user={user_id:"",user_name:"",user_email:"",user_phone:""},this.datetime="",this.page="",this.url="",this.referrer="",this.user_agent="",this.ip_address=""},Campaign=function(){this.utm_source="",this.utm_medium="",this.utm_content="",this.utm_campaign="",this.utm_term=""},Requests=function(){function t(t){this.base_url=document.location.protocol+"//portal.insensedata.com/",this.instance=axios.create({baseURL:this.base_url,timeout:5e3,headers:{"Access-Key":t,"Content-Type":"application/json"}})}return t.prototype.saveData=function(t){return console.log(t),this.instance.post("retail/api/clickstream",t)},t.prototype.getData=function(t){return this.instance.get(t)},t}(),IDTECommerceAnalytics=function(){function t(t){this.user_id="",this.event="",this.request=new Requests(t),this.meta=new Meta,this.campaign=new Campaign,this.identify(),this.sessionalize()}return t.prototype.identify=function(t,e,o,r){var n;return void 0===t&&(t=""),void 0===e&&(e=""),void 0===o&&(o=""),void 0===r&&(r=""),""===t?(this.meta.is_anon=!0,null!==(n=localStorage.getItem("idt_user_id"))&&0!==n.length||(n=this.generateTrackingId(),localStorage.setItem("idt_user_id",n)),this.meta.user.user_id=n):(this.meta.is_anon=!1,this.meta.user.user_id=t,this.meta.user.user_name=e,this.meta.user.user_email=o,this.meta.user.user_phone=r),this},t.prototype.toJson=function(){return{event:this.event,meta:this.meta,campaign:this.campaign,data:this.data}},t.prototype.setCookie=function(t,e,o){void 0===o&&(o={}),(o=__assign({path:"/"},o)).expires instanceof Date&&(o.expires=o.expires.toUTCString());var r=encodeURIComponent(t)+"="+encodeURIComponent(e);for(var n in o){r+="; "+n;var i=o[n];!0!==i&&(r+="="+i)}document.cookie=r},t.prototype.getCookie=function(t){var e=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return e?decodeURIComponent(e[1]):void 0},t.prototype.randomString=function(t,e){for(var o="",r=t;0<r;--r)o+=e[Math.floor(Math.random()*e.length)];return o},t.prototype.getRefQueryParam=function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))},t.prototype.generateTrackingSessionId=function(){return"IDT-SESSION-"+this.randomString(32,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ")},t.prototype.generateTrackingId=function(){return this.randomString(8,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ")+"-"+this.randomString(8,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ")+"-"+this.randomString(8,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ")+"-"+this.randomString(8,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ")},t.prototype.sessionalize=function(){var t=this.getCookie("idt_session");void 0===t?(t=this.generateTrackingSessionId(),this.setCookie("idt_session",t,{"max-age":3600}),this.meta.session=this.generateTrackingSessionId()):this.meta.session=t},t.prototype.setCampaign=function(){this.campaign.utm_source=this.getRefQueryParam("utm_source"),this.campaign.utm_medium=this.getRefQueryParam("utm_medium"),this.campaign.utm_content=this.getRefQueryParam("utm_content"),this.campaign.utm_campaign=this.getRefQueryParam("utm_campaign"),this.campaign.utm_term=this.getRefQueryParam("utm_term")},t.prototype.setMeta=function(){var t=new Date,e=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+(t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()),o=document.body.getAttribute("data-idt-page");this.meta.referrer=document.referrer,this.meta.url=window.location.href,this.meta.page=null!=o?o:"",this.meta.datetime=e,this.meta.user_agent=navigator.userAgent},t.prototype.getIP=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=document.location.protocol,[4,this.request.getData(e+"//api.ipify.org?format=json")];case 1:return[2,t.sent().ip]}})})},t.prototype.execute=function(t,e,o){void 0===o&&(o=""),this.setCampaign(),0<o.length&&(this.meta.page=o),this.event=t,this.data=e;var r=this.toJson();return this.request.saveData(r)},t.prototype.on=function(o,r,n){return void 0===n&&(n=""),__awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return this.setMeta(),this.getIP().then(function(t){e.meta.ip_address=t,e.execute(o,r,n)}).catch(function(t){console.log(t),e.execute(o,r,n)}),[2]})})},t.prototype.listen=function(t,e,o){for(var r=document.getElementsByClassName(t),n=0;n<r.length;n++)r[n].addEventListener(e,o)},t.prototype.isInViewPoint=function(t){var e=t.getBoundingClientRect();return 0<=e.top&&0<=e.left&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)},t.prototype.track=function(){var i=this;window.addEventListener("load",function(){var t=document.body.getAttribute("data-idt-page");i.on(page_load,{page:t})}),this.listen("idt-search","keyup",function(t,e){i.on(product_searched,{query:t.valueOf()})}),window.addEventListener("scroll",function(t){for(var e=document.getElementsByClassName("idt-products-list"),o=0;o<e.length;o++){var r,n=e[o];i.isInViewPoint(n)&&(r=n.getAttribute("data-idt-payload"),i.on(product_list_viewed,r))}})},t.prototype.onPageLoaded=function(t){return this.on(page_load,{page:t})},t.prototype.onProductSearched=function(t){var e={query:t};return this.on(product_searched,e)},t.prototype.onProductListViewed=function(t,e){void 0===e&&(e=[]);var o={category:t,products:e};return this.on(product_list_viewed,o)},t.prototype.onProductListFiltered=function(t,e,o,r){var n={category:t,filters:e,sorts:o,products:r};return this.on(product_list_filtered,n)},t.prototype.onPromotionViewed=function(t,e,o,r){var n={promotion_id:t,creative:o,name:e,position:r};return this.on(promotion_viewed,n)},t.prototype.onPromotionClicked=function(t,e,o,r){var n={promotion_id:t,creative:o,name:e,position:r};return this.on(promotion_clicked,n)},t.prototype.onProductClicked=function(t){return this.on(product_clicked,t)},t.prototype.onProductViewed=function(t){return this.on(product_viewed,t)},t.prototype.onProductAdded=function(t){return this.on(product_added,t)},t.prototype.onProductRemoved=function(t){return this.on(product_removed,t)},t.prototype.onCartViewed=function(t,e){var o={cart_id:t,products:e};return this.on(cart_viewed,o)},t.prototype.onCheckOutStarted=function(t,e){var o={order_id:t.order_id,value:t.value,revenue:t.revenue,shipping:t.shipping,tax:t.tax,discount:t.discount,currency:t.currency,products:e};return this.on(checkout_started,o)},t.prototype.onCheckOutStepViewed=function(t,e,o,r){var n={checkout_id:t,step:e,shipping_method:o,payment_method:r};return this.on(checkout_step_viewed,n)},t.prototype.onCheckOutStepCompleted=function(t,e,o,r){var n={checkout_id:t,step:e,shipping_method:o,payment_method:r};return this.on(checkout_step_completed,n)},t.prototype.onPaymentInfoEntered=function(t,e,o,r,n){var i={order_id:t,checkout_id:e,step:o,shipping_method:r,payment_method:n};return this.on(payment_info_entered,i)},t.prototype.onOrderCompleted=function(t,e){var o={checkout_id:t.checkout_id,order_id:t.order_id,subtotal:t.subtotal,total:t.total,revenue:t.revenue,shipping:t.shipping,tax:t.tax,discount:t.discount,coupon:t.coupon,currency:t.currency,products:e};return this.on(order_completed,o)},t.prototype.onOrderUpdated=function(t,e){var o={order_id:t.order_id,total:t.total,revenue:t.revenue,shipping:t.shipping,tax:t.tax,discount:t.discount,coupon:t.coupon,currency:t.currency,products:e};return this.on(order_updated,o)},t.prototype.onOrderCancelled=function(t,e){var o={order_id:t.order_id,total:t.total,revenue:t.revenue,shipping:t.shipping,tax:t.tax,discount:t.discount,coupon:t.coupon,currency:t.currency,products:e};return this.on(order_cancelled,o)},t.prototype.onOrderRefunded=function(t,e,o,r){var n={order_id:t,total:e,currency:o,products:r};return this.on(order_refunded,n)},t.prototype.onCouponEntered=function(t,e,o){var r={order_id:t,cart_id:e,coupon:o};return this.on(coupon_entered,r)},t.prototype.onCouponApplied=function(t,e,o,r){var n={order_id:t,cart_id:e,coupon:o,discount:r};return this.on(coupon_applied,n)},t.prototype.onCouponRemoved=function(t,e,o,r){var n={order_id:t,cart_id:e,coupon:o,discount:r};return this.on(coupon_removed,n)},t.prototype.onCouponDenied=function(t,e,o,r){var n={order_id:t,cart_id:e,coupon:o,reason:r};return this.on(coupon_denied,n)},t.prototype.onProductAddedToWishList=function(t){return this.on(product_added_to_wish_list,t)},t.prototype.onProductRemovedFromWishList=function(t){return this.on(product_removed_from_wish_list,t)},t.prototype.onWishListProductAddedToCart=function(t){return this.on(wish_list_product_added_to_cart,t)},t.prototype.onProductShared=function(t){return this.on(product_shared,t)},t.prototype.onCartShared=function(t,e,o,r,n){var i={cart_id:t,share_via:e,share_message:o,recipient:r,products:n};return this.on(cart_shared,i)},t.prototype.onProductReviewed=function(t,e,o,r){var n={product_id:t,review_id:e,review_body:o,rating:r};return this.on(product_reviewed,n)},t.prototype.onLogIn=function(t){return this.on(logged_in,t)},t.prototype.onLogOut=function(t){return this.on(logged_out,{user_id:t})},t.prototype.onSignUp=function(t){return this.on(signed_up,t)},t.prototype.onError=function(t,e,o){var r={type:t,message:e,data:o};return this.on(error,r)},t.prototype.onEvent=function(t,e){return this.on(t,e)},t}();